(function($){$.fn.youamaAjaxLogin=function(options){var opts=$.extend({},$.fn.youamaAjaxLogin.defaults,options);var register_is_ajax=false;var trigger_link=jQuery('header .account-link .links a');return start();function start(){replaceAjaxWindows();if(register_is_ajax){removeOriginalJsLocations();}openCloseWindowEvents();sendEvents();}function replaceAjaxWindows(){var loginWindow=$('.youama-login-window');var registerWindow=$('.youama-register-window');var loader=$('.youama-ajaxlogin-loader');$('#header-account').html(loginWindow);$('#header-account').append(registerWindow);$('#header-account').append(loader);}function removeOriginalJsLocations(){$('a[href*="customer/account/create"], '+'a[href*="customer/account/login"], '+'.customer-account-login .new-users button').attr('onclick','return false;');}function openCloseWindowEvents(){if(opts.autoShowUp=='yes'&&$('.messages').css('display')!='block'){trigger_link.trigger('click');animateShowWindow('login');}trigger_link.on('click',function(){if($('.youama-login-window').css('display')!='none'||$('.youama-register-window').css('display')!='none'){animateCloseWindow('login',false,false);}else{animateShowWindow('login');}return false;});$('.yoauam-switch-window').on('click',function(){if($(this).attr('id')=='y-to-login'){animateTop();animateCloseWindow('register',false,false);animateShowWindow('login');}else{animateTop();animateCloseWindow('login',false,false);animateShowWindow('register');}});if(register_is_ajax){$('a[href*="customer/account/create"], .new-users button').on('click',function(){trigger_link.trigger('click');animateCloseWindow('login',false,false);animateShowWindow('register');return false;});}$('.youama-login-window .close').click(function(){animateCloseWindow('login',true,true);});$('.youama-register-window .close').click(function(){animateCloseWindow('register',true,true);});autoClose();}function animateTop(){$('html,body').animate({scrollTop:0});}function sendEvents(){$('.youama-register-window button').on('click',function(){setDatas('register');validateDatas('register');if(opts.errors!=''){setError(opts.errors,'register');}else{callAjaxControllerRegistration();}return false;});$(document).keypress(function(e){if(e.which==13&&$('.youama-login-window').css('display')=='block'){setDatas('login');validateDatas('login');if(opts.errors!=''){setError(opts.errors,'login');}else{callAjaxControllerLogin();}}});$('.youama-login-window button').on('click',function(){setDatas('login');validateDatas('login');if(opts.errors!=''){setError(opts.errors,'login');}else{callAjaxControllerLogin();}return false;});}function animateShowWindow(windowName){$('.header-container .skip-content').hide();$('.youama-'+windowName+'-window').fadeIn();}function animateLoader(windowName,step){if(step=='start'){$('.youama-ajaxlogin-loader').fadeIn();$('.youama-window-outside').animate({opacity:'0.4'});}else{$('.youama-ajaxlogin-loader').fadeOut('normal',function(){$('.youama-window-outside').animate({opacity:'1'});});}}function animateCloseWindow(windowName,quickly,closeParent){if(opts.stop!=true){if(quickly==true){$('.youama-'+windowName+'-window').hide();$('.youama-ajaxlogin-error').hide(function(){if(closeParent){$('#header-account').removeClass('skip-active');}});}else{$('.youama-ajaxlogin-error').fadeOut();$('.youama-'+windowName+'-window').fadeOut(function(){if(closeParent){$('#header-account').removeClass('skip-active');}});}}}function validateDatas(windowName){opts.errors='';if(windowName=='register'){if(opts.lastname.length<1){opts.errors=opts.errors+'nolastname,'}if(opts.firstname.length<1){opts.errors=opts.errors+'nofirstname,'}if(opts.email.length<1){opts.errors=opts.errors+'noemail,'}else if(validateEmail(opts.email)!=true){opts.errors=opts.errors+'wrongemail,'}if(opts.password.length<1){opts.errors=opts.errors+'nopassword,'}else if(opts.password.length<6){opts.errors=opts.errors+'shortpassword,'}else if(opts.password.length>16){opts.errors=opts.errors+'longpassword,'}else if(opts.password!=opts.passwordsecond){opts.errors=opts.errors+'notsamepasswords,'}if(opts.licence!='ok'){opts.errors=opts.errors+'nolicence,'}}else if(windowName=='login'){if(opts.email.length<1){opts.errors=opts.errors+'noemail,'}else if(validateEmail(opts.email)!=true){opts.errors=opts.errors+'wrongemail,'}if(opts.password.length<1){opts.errors=opts.errors+'nopassword,'}else if(opts.password.length>16){opts.errors=opts.errors+'wronglogin,'}}}function validateEmail(emailAddress){var filter=/^([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/;if(filter.test(emailAddress)){return true;}else{return false;}}function setDatas(windowName){if(windowName=='register'){opts.firstname=$('.youama-'+windowName+'-window #youama-firstname').val();opts.lastname=$('.youama-'+windowName+'-window #youama-lastname').val();if($('.youama-'+windowName+'-window input[name="youama-newsletter"]:checked').length>0){opts.newsletter='ok';}else{opts.newsletter='no';}opts.email=$('.youama-'+windowName+'-window #youama-email').val();opts.password=$('.youama-'+windowName+'-window #youama-password').val();opts.passwordsecond=$('.youama-'+windowName+'-window #youama-passwordsecond').val();if($('.youama-'+windowName+'-window input[name="youama-licence"]:checked').length>0){opts.licence='ok';}else{opts.licence='no';}}else if(windowName=='login'){opts.email=$('.youama-'+windowName+'-window #youama-email').val();opts.password=$('.youama-'+windowName+'-window #youama-password').val();}}function setError(errors,windowName){$('.youama-'+windowName+'-window .youama-ajaxlogin-error').text('');$('.youama-'+windowName+'-window .youama-ajaxlogin-error').hide();var errorArr=new Array();errorArr=errors.split(',');var length=errorArr.length-1;for(var i=0;i<length;i++){var errorText=$('.ytmpa-'+errorArr[i]).text();$('.youama-'+windowName+'-window .err-'+errorArr[i]).text(errorText);}$('.youama-'+windowName+'-window .youama-ajaxlogin-error:not(.main)').fadeIn();}function setErrorMain(errors,windowName){$('.youama-'+windowName+'-window .youama-ajaxlogin-error').text('');$('.youama-'+windowName+'-window .youama-ajaxlogin-error').hide();var errorArr=new Array();errorArr=errors.split(',');var length=errorArr.length-1;var mainError='';for(var i=0;i<length;i++){var errorText=$('.ytmpa-'+errorArr[i]).text();mainError+='<div class="err-'+errorArr[i]+'">'+errorText+'</div>';}$('.youama-'+windowName+'-window .youama-ajaxlogin-error.main').html(mainError).fadeIn();}function callAjaxControllerRegistration(){if(opts.stop!=true){opts.stop=true;animateLoader('register','start');var ajaxRegistration=jQuery.ajax({url:opts.controllerUrl,type:'POST',data:{ajax:'register',firstname:opts.firstname,lastname:opts.lastname,newsletter:opts.newsletter,email:opts.email,password:opts.password,passwordsecond:opts.passwordsecond,licence:opts.licence},dataType:"html"});ajaxRegistration.done(function(msg){if(msg!='success'){setError(msg,'register');}else{opts.stop=false;animateCloseWindow('register',false,true);if(opts.redirection=='1'){window.location=opts.profileUrl;}else{window.location.reload();}}animateLoader('register','stop');opts.stop=false;});ajaxRegistration.fail(function(jqXHR,textStatus,errorThrown){opts.stop=false;animateLoader('register','stop');});}}function callAjaxControllerLogin(){if(opts.stop!=true){opts.stop=true;animateLoader('login','start');var ajaxRegistration=jQuery.ajax({url:opts.controllerUrl,type:'POST',data:{ajax:'login',email:opts.email,password:opts.password},dataType:"html"});ajaxRegistration.done(function(msg){if(msg!='success'){setErrorMain(msg,'login');}else{opts.stop=false;animateCloseWindow('login',false,true);if(opts.redirection=='1'){window.location=opts.profileUrl;}else{window.location.reload();}}animateLoader('login','stop');opts.stop=false;});ajaxRegistration.fail(function(jqXHR,textStatus,errorThrown){opts.stop=false;animateLoader('login','stop');});}}function autoClose(){closeInClose();$(window).resize(function(){closeInClose();});$('.skip-links a').click(function(){closeInClose();});}function closeInClose(){if($('.page-header-container #header-account').hasClass('skip-active')!=true){animateCloseWindow('login',true,false);animateCloseWindow('register',true,false);}}};$.fn.youamaAjaxLogin.defaults={redirection:'0',windowSize:'',stop:false,controllerUrl:'',profileUrl:'',autoShowUp:'',errors:'',firstname:'',lastname:'',newsletter:'no',email:'',password:'',passwordsecond:'',licence:'no'};})(jQuery);